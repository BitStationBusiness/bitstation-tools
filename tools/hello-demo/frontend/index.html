<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hello Demo - BitStation</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>ðŸš€ Hello Demo</h1>
            <p class="subtitle">Tool de demostraciÃ³n del ToolShell</p>
        </header>

        <main>
            <div class="status-bar" id="statusBar">
                <span class="status-dot"></span>
                <span id="connectionStatus">Conectando...</span>
            </div>

            <div class="input-section">
                <label for="messageInput">Tu mensaje:</label>
                <input 
                    type="text" 
                    id="messageInput" 
                    placeholder="Escribe algo..."
                    autocomplete="off"
                >
                <button id="sendBtn" class="primary-btn">
                    Enviar
                </button>
            </div>

            <div class="result-section" id="resultSection" style="display: none;">
                <h3>Respuesta:</h3>
                <div id="resultContent" class="result-box"></div>
            </div>

            <div class="debug-section">
                <details>
                    <summary>Debug Info</summary>
                    <pre id="debugLog"></pre>
                </details>
            </div>
        </main>

        <footer>
            <p>hello-demo v1.0.0 | api_contract: toolbridge/1</p>
        </footer>
    </div>

    <script src="bridge.js"></script>
    <script>
        const messageInput = document.getElementById('messageInput');
        const sendBtn = document.getElementById('sendBtn');
        const resultSection = document.getElementById('resultSection');
        const resultContent = document.getElementById('resultContent');
        const statusBar = document.getElementById('statusBar');
        const connectionStatus = document.getElementById('connectionStatus');
        const debugLog = document.getElementById('debugLog');

        function log(msg) {
            const time = new Date().toLocaleTimeString();
            debugLog.textContent += `[${time}] ${msg}\n`;
            console.log(msg);
        }

        // Inicializar Bridge
        async function init() {
            try {
                const info = await BitStationBridge.handshake();
                statusBar.classList.add('connected');
                connectionStatus.textContent = `Conectado (${info.platform}, Shell v${info.shell_version})`;
                log(`Handshake OK: ${JSON.stringify(info)}`);
            } catch (e) {
                statusBar.classList.add('web-mode');
                connectionStatus.textContent = 'Modo Web (sin Shell)';
                log(`Modo Web fallback: ${e.message}`);
            }
        }

        // Enviar mensaje
        async function sendMessage() {
            const message = messageInput.value.trim();
            if (!message) return;

            sendBtn.disabled = true;
            sendBtn.textContent = 'Enviando...';
            log(`Enviando: ${message}`);

            try {
                const result = await BitStationBridge.submitJob({
                    tool_id: 'hello-demo',
                    params: { message: message }
                });

                log(`Job creado: ${result.job_id}`);
                
                // Poll para resultado
                const output = await BitStationBridge.waitForResult(result.job_id);
                
                resultSection.style.display = 'block';
                resultContent.textContent = output.response || JSON.stringify(output);
                resultContent.classList.add('success');
                log(`Resultado: ${JSON.stringify(output)}`);

            } catch (e) {
                resultSection.style.display = 'block';
                resultContent.textContent = `Error: ${e.message}`;
                resultContent.classList.add('error');
                log(`Error: ${e.message}`);
            } finally {
                sendBtn.disabled = false;
                sendBtn.textContent = 'Enviar';
            }
        }

        // Event listeners
        sendBtn.addEventListener('click', sendMessage);
        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMessage();
        });

        // Init
        init();
    </script>
</body>
</html>
